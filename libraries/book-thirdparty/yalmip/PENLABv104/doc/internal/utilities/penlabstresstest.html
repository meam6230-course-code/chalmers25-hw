<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
                "http://www.w3.org/TR/REC-html40/loose.dtd">
<html>
<head>
  <title>Description of penlabstresstest</title>
  <meta name="keywords" content="penlabstresstest">
  <meta name="description" content="PENLABSTRESSTEST runs a series of tests on the solver.">
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
  <meta name="generator" content="m2html v1.5 &copy; 2003-2005 Guillaume Flandin">
  <meta name="robots" content="index, follow">
  <link type="text/css" rel="stylesheet" href="../m2html.css">
</head>
<body>
<a name="_top"></a>
<div><a href="../index.html">Home</a> &gt;  <a href="index.html">utilities</a> &gt; penlabstresstest.m</div>

<!--<table width="100%"><tr><td align="left"><a href="../index.html"><img alt="<" border="0" src="../left.png">&nbsp;Master index</a></td>
<td align="right"><a href="index.html">Index for utilities&nbsp;<img alt=">" border="0" src="../right.png"></a></td></tr></table>-->

<h1>penlabstresstest
</h1>

<h2><a name="_name"></a>PURPOSE <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
<div class="box"><strong>PENLABSTRESSTEST runs a series of tests on the solver.</strong></div>

<h2><a name="_synopsis"></a>SYNOPSIS <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
<div class="box"><strong>function [] = penlabstresstest(feeder,timestats,logs) </strong></div>

<h2><a name="_description"></a>DESCRIPTION <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
<div class="fragment"><pre class="comment"> PENLABSTRESSTEST runs a series of tests on the solver.

 This is to be used as an automated tool to run all possible
 test of the solver (e.g., a whole benchmarking library) to check
 how a possible source change influenced the behaviour of
 the solver.

 The problems to test are generated by FEEDER. This routine executes them 
 and prints out one-liner statistics for comparison.

 INPUT:
   feeder - routine returning the penlab objects to be ran,
            optional, if not present, the default feeder is used;
            it should look like:
               function [status,name,prob,res] = feeder(no)
            and to test number no=1..maxtests return status=0,
            problem name and problem as penlab object,
            expected results may be present in res, otherwise [],
            if there are problems with the test, status&lt;0,
            status=1 means out of range of test
   timestats - if (timestats), timing (tic/toc) is printed in the summary,
            optional, default true
   logs - if (logs), logs are produced for each of the tests in
            the current directory; optional, default false

 EXAMPLES:
   % use Matlab's diary to record the summary output
   diary('logtest_summary.txt');
   penlabstresstest();
   diary off;

   % using your own test set and default feeder:
   mytestset = {{ 'sdpa', 'datafiles/truss1.dat-s', -8.999996e+00 }, ...
                { 'bmi', 'datafiles/bmi_example.mat' }};
   myfeeder = @(no) penlabtestfeeder(no,mytestset);
   penlabstresstest(myfeeder);

   % default feeder but turn off timing and generate logs
   penlabstresstest(@penlabtestfeeder,0,1);


 See also <a href="penlabtestfeeder.html" class="code" title="function [status,name,prob,res] = penlabtestfeeder(no,testset)">penlabtestfeeder</a></pre></div>

<!-- crossreference -->
<h2><a name="_cross"></a>CROSS-REFERENCE INFORMATION <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
This function calls:
<ul style="list-style-image:url(../matlabicon.gif)">
<li><a href="penlabtestfeeder.html" class="code" title="function [status,name,prob,res] = penlabtestfeeder(no,testset)">penlabtestfeeder</a>	PENLABTESTFEEDER sets up one test to be run at a time.</li></ul>
This function is called by:
<ul style="list-style-image:url(../matlabicon.gif)">
</ul>
<!-- crossreference -->



<h2><a name="_source"></a>SOURCE CODE <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
<div class="fragment"><pre>0001 <a name="_sub0" href="#_subfunctions" class="code">function [] = penlabstresstest(feeder,timestats,logs)</a>
0002 <span class="comment">% PENLABSTRESSTEST runs a series of tests on the solver.</span>
0003 <span class="comment">%</span>
0004 <span class="comment">% This is to be used as an automated tool to run all possible</span>
0005 <span class="comment">% test of the solver (e.g., a whole benchmarking library) to check</span>
0006 <span class="comment">% how a possible source change influenced the behaviour of</span>
0007 <span class="comment">% the solver.</span>
0008 <span class="comment">%</span>
0009 <span class="comment">% The problems to test are generated by FEEDER. This routine executes them</span>
0010 <span class="comment">% and prints out one-liner statistics for comparison.</span>
0011 <span class="comment">%</span>
0012 <span class="comment">% INPUT:</span>
0013 <span class="comment">%   feeder - routine returning the penlab objects to be ran,</span>
0014 <span class="comment">%            optional, if not present, the default feeder is used;</span>
0015 <span class="comment">%            it should look like:</span>
0016 <span class="comment">%               function [status,name,prob,res] = feeder(no)</span>
0017 <span class="comment">%            and to test number no=1..maxtests return status=0,</span>
0018 <span class="comment">%            problem name and problem as penlab object,</span>
0019 <span class="comment">%            expected results may be present in res, otherwise [],</span>
0020 <span class="comment">%            if there are problems with the test, status&lt;0,</span>
0021 <span class="comment">%            status=1 means out of range of test</span>
0022 <span class="comment">%   timestats - if (timestats), timing (tic/toc) is printed in the summary,</span>
0023 <span class="comment">%            optional, default true</span>
0024 <span class="comment">%   logs - if (logs), logs are produced for each of the tests in</span>
0025 <span class="comment">%            the current directory; optional, default false</span>
0026 <span class="comment">%</span>
0027 <span class="comment">% EXAMPLES:</span>
0028 <span class="comment">%   % use Matlab's diary to record the summary output</span>
0029 <span class="comment">%   diary('logtest_summary.txt');</span>
0030 <span class="comment">%   penlabstresstest();</span>
0031 <span class="comment">%   diary off;</span>
0032 <span class="comment">%</span>
0033 <span class="comment">%   % using your own test set and default feeder:</span>
0034 <span class="comment">%   mytestset = {{ 'sdpa', 'datafiles/truss1.dat-s', -8.999996e+00 }, ...</span>
0035 <span class="comment">%                { 'bmi', 'datafiles/bmi_example.mat' }};</span>
0036 <span class="comment">%   myfeeder = @(no) penlabtestfeeder(no,mytestset);</span>
0037 <span class="comment">%   penlabstresstest(myfeeder);</span>
0038 <span class="comment">%</span>
0039 <span class="comment">%   % default feeder but turn off timing and generate logs</span>
0040 <span class="comment">%   penlabstresstest(@penlabtestfeeder,0,1);</span>
0041 <span class="comment">%</span>
0042 <span class="comment">%</span>
0043 <span class="comment">% See also penlabtestfeeder</span>
0044 <span class="comment">%</span>
0045 
0046 <span class="comment">% This file is a part of PENLAB package distributed under GPLv3 license</span>
0047 <span class="comment">% Copyright (c) 2013 by  J. Fiala, M. Kocvara, M. Stingl</span>
0048 <span class="comment">% Last Modified: 5/12/2013</span>
0049 
0050   <span class="comment">% relative precision for comparison the objective?</span>
0051   tol = 1e-4;
0052 
0053   <span class="keyword">if</span> (nargin&lt;3)
0054     logs = 0;
0055   <span class="keyword">end</span>
0056 
0057   <span class="keyword">if</span> (nargin&lt;2)
0058     timestats = 1;
0059   <span class="keyword">end</span>
0060 
0061   <span class="keyword">if</span> (nargin&lt;1)
0062     <span class="comment">% use default feeder with the default test set</span>
0063     feeder = @<a href="penlabtestfeeder.html" class="code" title="function [status,name,prob,res] = penlabtestfeeder(no,testset)">penlabtestfeeder</a>;
0064   <span class="keyword">end</span>
0065 
0066   <span class="comment">% run each test feeder returns</span>
0067   no = 1;
0068   nowrong = 0;
0069   <span class="keyword">while</span> (1)
0070     
0071     <span class="keyword">try</span>
0072       [status,name,prob,res] = feeder(no);
0073     <span class="keyword">catch</span>
0074       status = -99;
0075       name = <span class="string">'FEEDERPROBLEM'</span>;
0076       prob = [];
0077       res = [];
0078     <span class="keyword">end</span>
0079 
0080     <span class="keyword">if</span> (status==1)
0081       <span class="comment">% no more tests</span>
0082       <span class="keyword">break</span>;
0083     <span class="keyword">elseif</span> (status==0)
0084       <span class="comment">% all OK, run test</span>
0085 
0086       <span class="keyword">try</span>
0087         <span class="comment">% set common option settings:</span>
0088         <span class="comment">% turn off printing to the screen</span>
0089         prob.opts.outlev = 0;
0090         <span class="keyword">if</span> (logs)
0091           c = clock;
0092           stamp = sprintf(<span class="string">'%04i%02i%02i-%02i%02i'</span>,c(1:5));
0093           prob.opts.outlev_file = 2;
0094           prob.opts.out_filename = [<span class="string">'logtest-'</span> name <span class="string">'-'</span> stamp <span class="string">'.txt'</span>];
0095         <span class="keyword">else</span>
0096           prob.opts.outlev_file = 0;
0097         <span class="keyword">end</span>
0098 
0099         ifail = prob.solve();
0100 
0101         <span class="keyword">if</span> (~isempty(res))
0102           <span class="keyword">if</span> (abs(prob.objx - res)&lt;tol*(abs(prob.objx)+abs(res)))
0103             cmp = <span class="string">'ok'</span>;
0104           <span class="keyword">else</span>
0105             cmp = <span class="string">'XX'</span>;
0106           <span class="keyword">end</span>
0107         <span class="keyword">else</span>
0108           cmp = <span class="string">'  '</span>;
0109         <span class="keyword">end</span>
0110         <span class="keyword">if</span> (timestats)
0111           fprintf(<span class="string">'%-20s: %10.1fs   %4i/%4i/%4i   %10.2e  %2s   %2i\n'</span>,name,<span class="keyword">...</span>
0112             prob.stats_time_total,prob.miter,prob.initer,prob.lsiter,<span class="keyword">...</span>
0113             prob.objx,cmp,ifail);
0114         <span class="keyword">else</span>
0115           fprintf(<span class="string">'%-20s: %4i/%4i/%4i   %10.2e  %2s   %2i\n'</span>,name,<span class="keyword">...</span>
0116             prob.miter,prob.initer,prob.lsiter,<span class="keyword">...</span>
0117             prob.objx,cmp,ifail);
0118         <span class="keyword">end</span>
0119       <span class="keyword">catch</span>
0120         fprintf(<span class="string">'%-20s: SOLVER HARD ERROR!\n'</span>,name);
0121       <span class="keyword">end</span>
0122 
0123       clear prob;
0124 
0125     <span class="keyword">else</span>
0126       <span class="comment">% problem with generating the test</span>
0127       fprintf(<span class="string">'%-20s: cannot generate (%i)\n'</span>,name,status);
0128       nowrong = nowrong + 1;
0129       <span class="keyword">if</span> (nowrong&gt;10)
0130         <span class="keyword">break</span>;
0131       <span class="keyword">end</span>
0132     <span class="keyword">end</span>
0133 
0134     no = no + 1;
0135 
0136   <span class="keyword">end</span>
0137 
0138   fprintf(<span class="string">'END OF TESTS\n'</span>);
0139 
0140 <span class="keyword">end</span>
0141</pre></div>
<hr><address>Generated on Mon 26-Aug-2019 10:22:08 by <strong><a href="http://www.artefact.tk/software/matlab/m2html/" title="Matlab Documentation in HTML">m2html</a></strong> &copy; 2005</address>
</body>
</html>